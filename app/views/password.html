<nav class="uk-navbar-container uk-margin" uk-navbar>
  <div class="uk-navbar-left">
    <a class="uk-navbar-item uk-logo" id="logo" href="/">
    </a>

  </div>
  <div class="uk-navbar-right">
    <a href="/panel" class="uk-button uk-button-secondary uk-margin-right">Panel</a>
    <form action="/logout" method="POST" style="margin-block-end: 0;">
      <button class="uk-button uk-button-danger uk-margin-right">Logout</button>
    </form>
  </div>
</nav>

<div class="uk-container uk-container-small uk-section">
  <div>
    <img alt="nitr logo" src="/assets/images/logo.png" width="180" class="uk-margin-bottom">
  </div>
  <hr>
  <div class="uk-container" uk-grid>
    <div class="server" ukgrid>
      <form class="uk-form-horizontal uk-margin-large" id="passwordForm">
        <h3>Change Admin Password</h3>
        <div class="uk-margin">
          <label class="uk-form-label" for="current-password">CURRENT PASSWORD:</label>
          <div class="uk-form-controls">
            <input class="uk-input" name="currentPassword" id="current-password" type="password" placeholder=""
              autofocus>
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="new-password">NEW PASSWORD:</label>
          <div class="uk-form-controls">
            <input class="uk-input" name="newPassword" id="new-password" type="password" placeholder="">
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="repeat-new-password">REPEATE NEW PASSWORD:</label>
          <div class="uk-form-controls">
            <input class="uk-input" name="repeatRewPassword" id="repeat-new-password" type="password" placeholder="">
          </div>
        </div>
        <button id="saveBtn" class="uk-button uk-button-primary uk-button-large" disabled>
          SAVE
        </button>
      </form>
    </div>
  </div>
  <script>
    $(document).ready(function () {
      $("#passwordForm").keyup(function () {
        var currentPassword = $("#current-password").val()
        var newPassword = $("#new-password").val()
        var repeatNewPassword = $("#repeat-new-password").val()

        if (currentPassword == "" || newPassword == "" || repeatNewPassword == "") {
          $("#saveBtn").prop('disabled', true);
        } else {
          $("#saveBtn").prop('disabled', false);
        }
      })

      $('#saveBtn').click(function (e) {
        e.preventDefault();
        var currentPassword = $("#current-password").val()
        var newPassword = $("#new-password").val()
        var repeatNewPassword = $("#repeat-new-password").val()

        if (currentPassword == newPassword) {
          $("#saveBtn").prop('disabled', true);
          UIkit.notification({
            message: 'new password must be different to the current one',
            status: 'danger',
            pos: 'bottom-center',
            timeout: 5000
          });
        } else if (newPassword == repeatNewPassword) {
          const passwordForm = document.getElementById("passwordForm")
          const formData = new FormData(passwordForm)
          fetch('/password', {
              method: "POST",
              body: formData,
            })
            .then(function (response) {
              if (response.ok) {
                $('#passwordForm').trigger("reset");
                $("#saveBtn").prop('disabled', true);
                UIkit.notification({
                  message: 'password changed succesfully',
                  status: 'success',
                  pos: 'bottom-center',
                  timeout: 5000
                });
              } else {
                $("#saveBtn").prop('disabled', true);
                UIkit.notification({
                  message: 'current password invalid',
                  status: 'danger',
                  pos: 'bottom-center',
                  timeout: 5000
                });
              }

            });
          var btn = $(this);
          btn.prop('disabled', true)
            .attr("uk-spinner", true)
          setTimeout(function () {
            btn.prop('disabled', false)
              .removeAttr("uk-spinner")
          }, 500);
        } else {
          UIkit.notification({
            message: "passwords doesn't match",
            status: 'danger',
            pos: 'bottom-center',
            timeout: 5000
          });
        }
      });
    })
  </script>